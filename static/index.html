<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Sistema di gestione perizie assicurative" />
    <meta name="author" content="Insurance Co." />
    <title>Sistema Gestione Perizie</title>
    <!-- Font Awesome icons -->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet" />
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link href="styles.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="./scripts.js"></script>
    <script src="libreria.js"></script>
</head>
<body>
    <!-- Authentication Section - Shown by default -->
    <div class="auth-container" id="authSection">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5">
                    <!-- Logo e intestazione -->
                    <div class="text-center mb-4">
                        <i class="fas fa-shield-alt fa-3x text-primary mb-2"></i>
                        <h2>Sistema Gestione Perizie</h2>
                        <p class="text-muted">Accedi per continuare</p>
                    </div>

                    <!-- Card login -->
                    <div class="card shadow-lg" id="loginCard">
                        <div class="card-body p-4">
                            <h4 class="card-title text-center mb-4">Login</h4>
                            
                            <!-- Alert per errori -->
                            <div class="alert alert-danger d-none" id="loginError" role="alert"></div>
                            
                            <!-- Form login -->
                            <form id="loginForm">
                                <div class="mb-3">
                                    <label for="loginUsername" class="form-label">Username</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                                        <input type="text" class="form-control" id="loginUsername" name="username" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="loginPassword" class="form-label">Password</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                        <input type="password" class="form-control" id="loginPassword" name="password" required>
                                        <button class="btn btn-outline-secondary toggle-password" type="button">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="rememberMe">
                                    <label class="form-check-label" for="rememberMe">Ricordami</label>
                                </div>
                                <div class="d-grid gap-2 mb-3">
                                    <button type="submit" class="btn btn-primary">Accedi</button>
                                </div>
                                <div class="text-center">
                                    <p class="mb-0">Non hai un account? <a href="#" class="text-decoration-none" id="contactAdminLink">Contatta l'amministratore</a></p>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Card per cambio password al primo accesso -->
                    <div class="card shadow-lg d-none" id="passwordChangeCard">
                        <div class="card-body p-4">
                            <h4 class="card-title text-center mb-4">Modifica Password</h4>
                            <div class="alert alert-info" role="alert">
                                <i class="fas fa-info-circle me-2"></i>È necessario modificare la password al primo accesso.
                            </div>
                            
                            <!-- Alert per errori -->
                            <div class="alert alert-danger d-none" id="passwordChangeError" role="alert"></div>
                            
                            <!-- Form cambio password -->
                            <form id="passwordChangeForm">
                                <div class="mb-3">
                                    <label for="newPassword" class="form-label">Nuova Password</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-key"></i></span>
                                        <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="confirmPassword" class="form-label">Conferma Password</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-check"></i></span>
                                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                                    </div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary">Cambia Password</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Section - Hidden initially -->
    <div class="d-none" id="dashboardSection">
        <!-- Navbar principale (sostituisce la sidebar) -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#dashboard">
                    <i class="fas fa-shield-alt me-2"></i>Sistema Gestione Perizie
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarContent">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="#dashboard">
                                <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#perizie">
                                <i class="fas fa-clipboard-list me-1"></i>Perizie
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#operatori">
                                <i class="fas fa-users me-1"></i>Operatori
                            </a>
                        </li>
                    </ul>
                    
                    <!-- Utente e Logout (spostati a destra) -->
                    <div class="d-flex align-items-center user-info-container">
                        <div class="d-flex align-items-center me-3">
                            <div class="avatar-circle bg-primary text-white me-2" style="width: 32px; height: 32px;">
                                <span id="userInitials">U</span>
                            </div>
                            <div class="text-white user-details">
                                <div id="userDisplayName">Admin</div>
                                <small class="text-muted" id="userRole">Amministratore</small>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-outline-light" id="btnLogout">
                            <i class="fas fa-sign-out-alt me-1"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Content Area (senza la sidebar) -->
        <main class="container-fluid px-4 py-3">
            <!-- Header con titolo -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-2 pb-2 mb-3 border-bottom" id="dashboard">
                <h1 class="h2">Dashboard</h1>
                <h3 class="text-muted">Rilievi e Perizie</h3>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent">
                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-clipboard-list me-2"></i>Perizie Totali</h5>
                                <p class="card-text display-6" id="totalInspections">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-success">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-users me-2"></i>Operatori Attivi</h5>
                                <p class="card-text display-6" id="activeUsers">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-warning">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-hourglass-half me-2"></i>Perizie in Attesa</h5>
                                <p class="card-text display-6" id="pendingInspections">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resto del contenuto dashboard non modificato -->
                <div class="row mb-4">
                    <!-- Perizie in corso -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="fas fa-clock me-2"></i>Perizie in Corso</div>
                                    <span class="badge bg-dark">3</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">PRZ-2025-002</h6>
                                            <small>Roma, Via Nazionale 45</small>
                                        </div>
                                        <div class="text-end">
                                            <div>Laura Bianchi</div>
                                            <small class="text-muted">23/04/2025 14:15</small>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">PRZ-2025-004</h6>
                                            <small>Firenze, Viale dei Colli 12</small>
                                        </div>
                                        <div class="text-end">
                                            <div>Paolo Neri</div>
                                            <small class="text-muted">24/04/2025 16:30</small>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">PRZ-2025-005</h6>
                                            <small>Torino, Corso Francia 78</small>
                                        </div>
                                        <div class="text-end">
                                            <div>Claudia Verdi</div>
                                            <small class="text-muted">25/04/2025 11:45</small>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            <div class="card-footer text-end">
                                <a href="#perizie" class="btn btn-sm btn-outline-warning">Vedi Tutte</a>
                            </div>
                        </div>
                    </div>

                    <!-- Operatori attivi -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="fas fa-user-check me-2"></i>Operatori in Perizia</div>
                                    <span class="badge bg-light text-dark" id="operatoriInPeriziaCount">0</span>
                                </div>
                            </div>
                            
                            <div class="card-body">
                                <div class="list-group" id="operatoriInPeriziaList">
                                    <!-- Gli operatori verranno inseriti qui dinamicamente -->
                                    <div class="text-center py-3 text-muted">
                                        <i class="fas fa-spinner fa-spin me-2"></i>Caricamento operatori...
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-footer text-end">
                                <a href="#operatori" id="visualizzaOperatori" class="btn btn-sm btn-outline-success">Gestisci Operatori</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Inspections Table -->
                <h2>Perizie Recenti</h2>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                
                                <th>ID</th>
                                <th>Operatore</th>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Indirizzo</th>
                                <th>Stato</th>
                                <th>Foto</th>
                                <th>Azioni</th>
                            </tr>
                        </thead>
                        <tbody id="inspectionTableBody">
                            <!-- Dati caricati dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sezione Operatori (rinominata da "gestione-utenti-content") -->
            <div id="operatori-content" class="d-none">
                <div class="container-fluid">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Operatori</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button id="addOperatoreBtn" class="btn btn-sm btn-primary" onclick="addOperatore()">
                                <i class="fas fa-user-plus me-1"></i>Nuovo Operatore
                            </button>
                        </div>
                    </div>
                    
                    <!-- Alert per errori o messaggi -->
                    <div id="operatori-alert" class="alert alert-danger d-none" role="alert"></div>
                    
                    <!-- Loader animato -->
                    <div id="operatori-loader" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Caricamento...</span>
                        </div>
                        <p class="mt-2 text-muted">Caricamento operatori in corso...</p>
                    </div>
                    
                    <!-- Cards degli operatori -->
                    <div id="operatori-cards" class="row g-3 mt-2">
                        <!-- Le card degli operatori verranno generate dinamicamente qui -->
                    </div>
                </div>
            </div>
            
            <!-- Perizie Section -->
            <div id="perizie-content" class="d-none">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Gestione Perizie</h1>
                    
                </div>
                
                <!-- Mappa delle perizie -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-map-marked-alt me-2"></i>Mappa delle perizie
                    </div>
                    <div class="card-body">
                        <div id="perizieMappa" style="height: 400px;"></div>
                    </div>
                </div>
                
                <!-- Filtri delle perizie -->
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <i class="fas fa-filter me-2"></i>Filtra perizie
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="filterOperator" class="form-label">Operatore</label>
                                <select class="form-select" id="filterOperator">
                                    <option value="">Tutti gli operatori</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="filterDate" class="form-label">Data</label>
                                <input type="date" class="form-control" id="filterDate">
                            </div>
                            <!-- State filter removed -->
                            <div class="col-md-4 d-flex align-items-end">
                                <div class="d-grid gap-2 w-100">
                                    <button class="btn btn-primary" id="applyFilters">
                                        <i class="fas fa-search me-1"></i>Applica filtri
                                    </button>
                                    <button class="btn btn-outline-secondary" id="resetFilters">
                                        <i class="fas fa-times me-1"></i>Reimposta
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabella delle perizie con gestione selezioni -->
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-clipboard-list me-2"></i>Elenco Perizie
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-light text-dark me-2">Totale: <span id="perizieTotali">0</span></span>
                            <span class="badge bg-light text-dark">Visualizzate: <span id="perizieVisualizzate">0</span></span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="selectAllInspections">
                                <label class="form-check-label" for="selectAllInspections">Seleziona tutti</label>
                            </div>
                            <div>
                                <button id="deleteSelectedInspections" class="btn btn-sm btn-danger" disabled>
                                    <i class="fas fa-trash me-1"></i>Elimina selezionate (0)
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="headerCheckbox">
                                            </div>
                                        </th>
                                        <th>ID</th>
                                        <th>Operatore</th>
                                        <th>Data</th>
                                        <th>Tipo</th>
                                        <th>Indirizzo</th>
                                        <th>Stato</th>
                                        <th>Foto</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody id="perizieTableBody">
                                    <!-- Dati perizie verranno inseriti qui -->
                                    <tr>
                                        <td colspan="9" class="text-center py-3">Caricamento dati...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between align-items-center">
                        <div>
                            Elementi selezionati: <span id="selectedCount">0</span> di <span id="perizieTotaliFooter">0</span>
                        </div>
                        <nav aria-label="Paginazione perizie">
                            <ul class="pagination mb-0">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Precedente</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Successiva</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                
                <!-- Modal conferma eliminazione multiple -->
                <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Conferma eliminazione</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Stai per eliminare <span id="deleteCount">0</span> perizie. Questa operazione non può essere annullata.</p>
                                <p>Sei sicuro di voler procedere?</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                                    <i class="fas fa-trash me-1"></i>Elimina definitivamente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aggiungi questa sezione dopo il contenuto di "perizie-content" e prima del footer -->

            <!-- Sezione operatori non-admin - visibile solo per utenti normali -->
            <div id="user-perizie-content" class="d-none">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Le Mie Perizie</h1>
                    
                </div>

                <!-- Stato delle perizie -->
                <div class="row mb-4">
                    <div class="col-lg-4">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-clipboard-list me-2"></i>Perizie Totali</h5>
                                <p class="card-text display-6" id="userTotalInspections">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-check-circle me-2"></i>Perizie Completate</h5>
                                <p class="card-text display-6" id="userCompletedInspections">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card bg-warning text-dark">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-hourglass-half me-2"></i>Perizie In Corso</h5>
                                <p class="card-text display-6" id="userPendingInspections">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mappa delle perizie dell'utente -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <i class="fas fa-map-marked-alt me-2"></i>Mappa delle mie perizie
                    </div>
                    <div class="card-body">
                        <div id="userPerizieMappa" style="height: 400px;"></div>
                    </div>
                </div>
                
                <!-- Tabella perizie assegnate all'utente -->
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-clipboard-list me-2"></i>Le mie perizie
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-light text-dark me-2">Totale: <span id="userPerizieTotali">0</span></span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Data</th>
                                        <th>Tipo</th>
                                        <th>Indirizzo</th>
                                        <th>Stato</th>
                                        <th>Foto</th>
                                        <th>Azioni</th>
                                    </tr>
                                </thead>
                                <tbody id="userPerizieTableBody">
                                    <!-- Dati perizie verranno inseriti qui -->
                                    <tr>
                                        <td colspan="7" class="text-center py-3">Caricamento dati...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between align-items-center">
                        <div>
                            Perizie assegnate: <span id="userPerizieTotaliFooter">0</span>
                        </div>
                        <nav aria-label="Paginazione perizie">
                            <ul class="pagination mb-0" id="userPeriziePagination">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Precedente</a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">Successiva</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>

                <!-- Modal per aggiungere foto -->
                <div class="modal fade" id="addPhotoModal" tabindex="-1" aria-labelledby="addPhotoModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title" id="addPhotoModalLabel"><i class="fas fa-camera me-2"></i>Aggiungi Foto</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                            </div>
                            <div class="modal-body">
                                <form id="photoUploadForm">
                                    <input type="hidden" id="periziaIdForPhoto">
                                    <div class="mb-3">
                                        <label for="photoFile" class="form-label">Seleziona immagine</label>
                                        <input class="form-control" type="file" id="photoFile" accept="image/*" multiple>
                                    </div>
                                    <div class="mb-3">
                                        <label for="photoComment" class="form-label">Commento</label>
                                        <textarea class="form-control" id="photoComment" rows="3" placeholder="Descrivi le foto che stai caricando..."></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Anteprima</label>
                                        <div id="photoPreview" class="row g-2"></div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                                <button type="button" class="btn btn-primary" id="uploadPhotoBtn">
                                    <i class="fas fa-upload me-1"></i>Carica Foto
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal per creare nuova perizia -->
                <div class="modal fade" id="newPeriziaModal" tabindex="-1" aria-labelledby="newPeriziaModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title" id="newPeriziaModalLabel"><i class="fas fa-plus-circle me-2"></i>Nuova Perizia</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Chiudi"></button>
                            </div>
                            <div class="modal-body">
                                <form id="newPeriziaForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="newPeriziaTipo" class="form-label">Tipo perizia</label>
                                            <select class="form-select" id="newPeriziaTipo" required>
                                                <option value="" selected disabled>Seleziona tipo</option>
                                                <option value="incendio">Incendio</option>
                                                <option value="allagamento">Allagamento</option>
                                                <option value="furto">Furto</option>
                                                <option value="grandine">Grandine</option>
                                                <option value="altro">Altro</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="newPeriziaData" class="form-label">Data e ora</label>
                                            <input type="datetime-local" class="form-control" id="newPeriziaData" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newPeriziaIndirizzo" class="form-label">Indirizzo</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="newPeriziaIndirizzo" placeholder="Inserisci indirizzo" required>
                                            <button class="btn btn-outline-secondary" type="button" id="searchAddressBtn">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Posizione sulla mappa</label>
                                        <div id="newPeriziaMapContainer" style="height: 300px;"></div>
                                        <input type="hidden" id="newPeriziaLat">
                                        <input type="hidden" id="newPeriziaLng">
                                    </div>
                                    <div class="mb-3">
                                        <label for="newPeriziaDescrizione" class="form-label">Descrizione</label>
                                        <textarea class="form-control" id="newPeriziaDescrizione" rows="3" required></textarea>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="newPeriziaCliente" class="form-label">Nome cliente</label>
                                            <input type="text" class="form-control" id="newPeriziaCliente" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="newPeriziaContatto" class="form-label">Contatto cliente</label>
                                            <input type="text" class="form-control" id="newPeriziaContatto" placeholder="Telefono o email">
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="newPeriziaPolizza" class="form-label">Numero polizza</label>
                                        <input type="text" class="form-control" id="newPeriziaPolizza">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                                <button type="button" class="btn btn-primary" id="saveNewPeriziaBtn">
                                    <i class="fas fa-save me-1"></i>Salva Perizia
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- I modali possono rimanere non modificati -->
    </div>
    <footer class="footer mt-auto py-3 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3 mb-md-0">
                    <h5>Sistema Gestione Perizie</h5>
                    <p class="text-muted mb-0">Versione 1</p>
                    <p class="small text-muted">© 2025 Progetto Rilievi. Tutti i diritti riservati</p>
                </div>
                <div class="col-md-4 mb-3 mb-md-0">
                    <h5>Contatti</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i>g.verilio.2755@ivallauri.edu</li>
                        <li><i class="fas fa-building me-2"></i>vallauri fossano</li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Link Utili</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white">Supporto Tecnico</a></li>
                        <li><a href="#" class="text-white">Documentazione</a></li>
                        <li><a href="#" class="text-white">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="scripts.js"></script>

</body>
</html>